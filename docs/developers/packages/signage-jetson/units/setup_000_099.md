# setup(000-099)

## **000_write_env_files.sh**

このスクリプトは、デバイスごとの識別子・ボード種別・GitHub/AWS の資格情報を引数で受け取り、**/etc/signage 配下に環境ファイルを生成**します。  
生成されるのは次の2つです。

- `/etc/signage/signage.env` …… 一般設定（権限 **644**）
- `/etc/signage/secret.env` …… 機密情報（権限 **600**）

これにより、以後のセットアップスクリプトや systemd サービスが**一貫した場所から設定・秘密情報を読み込める**ようになります。

> ### 実行方法

```bash
# ルート権限での実行を推奨
sudo bash scripts/setup/000_write_env_files.sh \
  <DEVICE_ID> <BOARD_TYPE> <GH_TOKEN> <AWS_ACCESS_KEY_ID> <AWS_SECRET_ACCESS_KEY>

# 例
sudo bash scripts/setup/000_write_env_files.sh \
  XIG-JON-000 jetsonorinnano ghp_xxxxxxxxxxxxxxxxxxxxx \
  AKIAxxxxxxxxxxxxxxxx wJalrXUtnFEMI/K7MDENG/bPxRfiCYxxxxxxxx
```

- `/etc/signage/signage.env`（権限: **0644**）
一般設定を格納します。`SIGNAGE_CORE_DIR` は実行時の環境変数がそのまま書き込まれます。

```dotenv
# Example environment variables for signage
SIGNAGE_CORE_DIR=<SIGNAGE_CORE_DIR>
DEVICE_ID=<DEVICE_ID>
BOARD_TYPE=<BOARD_TYPE>
NODE_ENV=production
```

- /etc/signage/secret.env（権限: **0600**）

機密情報を格納します。GitHub/AWS 資格情報と、既定リージョン ap-northeast-1 が書き込まれます。

```dotenv
# Secret environment variables for signage
GH_TOKEN=<GH_TOKEN>
AWS_ACCESS_KEY_ID=<AWS_ACCESS_KEY_ID>
AWS_SECRET_ACCESS_KEY=<AWS_SECRET_ACCESS_KEY>
AWS_DEFAULT_REGION=ap-northeast-1
```

> ### 引数の説明

| 引数                      |  必須 | 例                         | 説明                                                 |
| ----------------------- | :-: | ------------------------- | -------------------------------------------------- |
| `DEVICE_ID`             |  ✅  | `XIG-JON-000`                | デバイスの一意な識別子。運用・監視・ログ関連で参照します。                        |
| `BOARD_TYPE`            |  ✅  | `jetsonorinnano` | ハードウェア種別。後続のセットアップ分岐や最適化に利用。                       |
| `GH_TOKEN`              |  ✅  | `ghp_xxx...`              | GitHub からのプライベート取得等に用いる Personal Access Token（機密）。 |
| `AWS_ACCESS_KEY_ID`     |  ✅  | `AKIA...`                 | AWS アクセスキー ID。                                     |
| `AWS_SECRET_ACCESS_KEY` |  ✅  | `wJalrXUtnF...`           | AWS シークレットアクセスキー（機密）。                              |

---

## **050_fix_hosts.sh**

このスクリプトは、現在のホスト名（`/etc/hostname`）が **/etc/hosts に自己解決可能なエントリ**として登録されているかを確認し、未登録なら **`127.0.1.1 <hostname>` を追記**します。  
Ubuntu/Debian 系で一般的な慣習（`127.0.1.1` にホスト名を割り当て）に従い、**`sudo` の遅延や一部ツールの名前解決不良を防止**します。

!!! info "この対応の主目的（よくある症状）"
    `sudo: unable to resolve host <hostname>: Name or service not known`  
    `/etc/hostname` と `/etc/hosts` の不整合、または DNS 不達時に発生しやすいエラーを、**DNS に依存しない自己解決**で回避します。

---

## **055_include_usercfg_pi.sh**

このスクリプトは **Raspberry Pi 系ボードでのみ有効**になり、起動設定を調整します。

- `BOARD_TYPE` に `rasp` または `pi` を含まない場合は **何もせず終了**（安全にスキップ）
- `/boot/firmware/config.txt` に **`include usercfg.txt` を追記（未設定時）**
- 同ファイルに **`dtoverlay=disable-bt` を追記（未設定時）**  
  → 内蔵 Bluetooth を無効化（UART の占有回避や干渉低減などの目的）  

!!! note "なぜ `config.txt` に書くのか"
    本実装は **確実性と単純化** を優先して `dtoverlay=disable-bt` を *config.txt へ直接* 設定します。  
    `usercfg.txt` はユーザー上書き用として include されますが、環境やベンダーイメージによっては読み込み順・優先度が異なる場合があります。  
    そのため、本リポジトリでは **overlay は config.txt に固定**し、`usercfg.txt` は *他のユーザー設定用の拡張ポイント* として確保します。

---

## **060_enable_uart_pi.sh**

---
