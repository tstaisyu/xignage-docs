# setup(100-199)

## **100_install_node.sh**

このスクリプトは、既存の Node.js を削除して **Nodesource** から指定バージョン（`$NODE_VERSION`）を導入し、**signage-server** の最新リリースと **signage-admin-ui** を GitHub Releases から取得・検証（SHA256）・設置します。サーバはタイムスタンプ付きの `releases/<YYYYmmdd_HHMMSS>` に展開し、`current` シンボリックリンクを新リリースへ更新します。  
`$NODE_VERSION` が見つからない場合は **20.x にフォールバック**します。

> 処理の流れ

1) **既存 Node.js の削除**  

2) **Node.js の導入**  

3) **signage-server ディレクトリの準備**  
   - `"$SIGNAGE_CORE_DIR"` に対して `chown -R "$USERNAME:$USERNAME"` / `chmod -R 755`

4) **signage-server の最新リリース取得・展開**  
   - API: `https://api.github.com/repos/tstaisyu/signage-server/releases/latest`  
   - 取得アセット: `signage-server.tar.gz` / `signage-server.tar.gz.sha256`  
   - `sha256sum -c` で検証 → `releases/<TIMESTAMP>` に展開 → `npm ci --omit=dev --ignore-scripts`  
   - `current` を新リリースへ `ln -sfn` → 新リリースを `chown -R "$USERNAME:$USERNAME"`

5) **signage-admin-ui の最新リリース取得・展開**  
   - API: `https://api.github.com/repos/tstaisyu/signage-admin-ui/releases/latest`  
   - 取得アセット: `admin-ui.tar.gz` / `admin-ui.tar.gz.sha256`  
   - 既存の `$ADMIN_UI_DIR` を削除→再作成→展開→`chown -R "$USERNAME:$USERNAME"`

6) **設定完了後、tmp/の一時ファイルを削除**

!!! 注意
    `npm ci --ignore-scripts`: postinstall 等のスクリプトは実行されません。必要な場合は運用方針に応じて外してください。

---

## **101_install_edge_detection.sh**

---

## **105_install_metrics_service.sh**

---

## **110_write_iot_certs_and_env.sh**
