# setup(200-599)

## **200_netplan_disable_nm.sh**

ネットワーク管理を **systemd-networkd に統一**します。

1) **競合サービスの無効化**：`NetworkManager`, `wpa_supplicant`, `wpa_supplicant@<iface>`  
2) **systemd-networkd の有効化**  
3) **`eth0` を DHCP4 有効にする netplan** を生成・適用

!!! note "注意"
    - 変更中に SSH が切断される可能性があるため、可能ならローカルコンソールで実行してください。

---

## **300_hostapd_dnsmasq.sh**

AP（アクセスポイント）モード用の **hostapd / dnsmasq 設定**を冪等に生成します。

- `hostapd.conf`：`country_code=JP`, SSID/PSK などを設定
- `dnsmasq.conf`：`192.168.4.0/24` の DHCP を提供

---

## **400_ap_start_wifi_or_ap.sh**

`ap_start` / `wifi_or_ap` を配置し、`wifi-or-ap.service` と `wifi-or-ap.timer` を作成します。  
タイマーは **起動 30 秒後に実行**し、**5 分間隔で再実行**します。

---

## **500_wifi_manager.sh**

Wi-Fi 設定 UI（`wifi_manager.py` / `index.html`）を Web ルートへ配置し、`wifi-manager.service` を作成します。

- 実行コマンド：`/opt/signage-core/venv/bin/python` で起動
- `WIFI_FLAG_FILE` を環境変数として注入

---

## **550_boot_optimize.sh**

バックグラウンド更新や不要サービスを抑制し、起動とリソース消費を最適化します。

- snapd の更新抑止とソケット起動化
- cloud-init / rpi-eeprom-update / networkd-dispatcher などをマスク
- fstrim をタイマーで運用
- Pi の Bluetooth HCI 無効化
