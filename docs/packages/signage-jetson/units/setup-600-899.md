# setup(600-899)

## **600_signage_jetson.sh**

`update_runner` / `update_manager` / `healthcheck` を配置し、`signage-update.service` を生成します。  
ユニットは **root 実行（User 指定なし）**で、`/etc/signage/secret.env` と `/etc/signage/signage.env` を読み込み、`update_manager` を起動します。

- `FailureAction=reboot` が有効
- `TimeoutStartSec=3min` / `TimeoutStopSec=30s`

---

## **610_install_trt_runtime.sh**

**Jetson のみ**で TensorRT / PyCUDA / OpenCV (Python) の最小ランタイムを導入します。  
Pi は自動スキップされます。

---

## **700_jetson_server.sh**

コンテンツ格納ディレクトリを整備し、**linger 有効化**・**ホスト名設定 + mDNS（Avahi）**を行います。  
`systemd --user` で `signage-server.service` を生成・起動します。

---

## **710_signage_server_port_override.sh**

`signage-server.service` の drop-in を作成し、`PORT=3001` を付与します。  
`systemctl --user daemon-reload` → `restart` を行います。

---

## **720_nginx_setup.sh**

Nginx の vhost を作成し、**`:3000 → 127.0.0.1:3001`** へリバースプロキシします。  
**`/admin` の静的配信は行いません**（すべて Node 側へプロキシ）。

- `DEFAULT_SITE` を削除
- `sites-available/signage-device` を生成
- **lighttpd が稼働中なら停止/無効化**
- nginx を enable / start / reload

---

## **800_firewall.sh**

`FIREWALL_PORTS` に列挙されたポートを UFW に許可ルールとして追加します。  
`ufw enable` は自動では実行しません。
